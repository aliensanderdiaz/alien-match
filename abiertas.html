<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABIERTAS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    
    <div id="container" class="container pt-4">

    </div>

        <div class="container container-apuestas-agrupadas">

    </div>
    <div id="container-todos" class="container pb-4">

    </div>



    <script src="apuestas-abiertas.js"></script>
    <script>

        let cuotaAcumulada = 1

        function hacerFilaPartido(partido, index) {
            if (index === 1) {
                cuotaAcumulada = 1
            }
            cuotaAcumulada *= partido[4]
            partido[0] = partido[0] - 10000
            console.log({ partido, index })
            return `
                <div class="row ${index % 2 === 0 ? 'bg-secondary-subtle' : ''}">
                    <div class="col-1"><small>${index}</small></div>
                    <div class="col-2"><small>${partido[0]}</small></div>
                    <div class="col-3">
                        <small>${partido[1].slice(0, 15)}</small>
                        <br>
                        <small>${partido[2].slice(0, 15)}</small>
                    </div>
                    <div class="col-2">
                        <small><a href="${partido[5]}" target="_blank">${partido[3].substring(0, 3).toUpperCase()}</a></small>
                        <br>
                        <small>${partido[6]}</small>
                    </div>
                    <div class="col-2">${partido[4].toFixed(2) || 1}</div>
                    <div class="col-2 text-end">${Math.trunc(cuotaAcumulada).toFixed(0) || 1}</div>
                </div>
            `
        }



        let html = ''
        let html_todos = ''
        let partidos_todos = []

        APUESTAS_ABIERTAS.forEach(grupo => {
            grupo = grupo.sort((a, b) => a[0] - b[0])
            grupo.forEach((partido, index) => {



                html += index === 0 ? '<div class="row text-end"><span>Partidos: ' + (grupo.length - 1) + '</span><b>Ganancia Esperada: $ ' + partido + '</b></div>' : hacerFilaPartido(partido, index)

                let partido_encontrado = partidos_todos.find(p => p[1] === partido[1])
                if (!partido_encontrado && Array.isArray(partido)) {
                    partidos_todos.push(partido)

                }
            })
            html += '<hr>'


        });

        partidos_todos = partidos_todos.sort((a, b) => a[0] - b[0])

        partidos_todos.forEach((partido, index) => {
            html_todos += `
                    <div class="row ${index % 2 === 0 ? 'bg-secondary-subtle' : ''}">
                        <div class="col-2"><small>${partido[0]}</small></div>
                        <div class="col-5"><small>${partido[1].slice(0, 15)}</small></div>
                        <div class="col-5"><small>${partido[2].slice(0, 15)}</small></div>
                    </div>
                `
        });

        html_todos += `
            <div class="row">
                <div class="col">
                    <p>
                        <b>Cantidad de Partidos:</b> ${partidos_todos.length}
                        <br>
                        <b>Cantidad de Apuestas:</b> ${APUESTAS_ABIERTAS.length}
                    </p>
                </div>
            </div>
        `

        document.querySelector('#container').innerHTML = html
        document.querySelector('#container-todos').innerHTML = html_todos


    </script>

    <script>
        let codes_mitad = []
        let codes_ambos = []
        let codes_over = []
        let codes_local = []
        let codes_visitante = []

        let todas = []

        APUESTAS_ABIERTAS.forEach(apuesta => {
            apuesta.forEach(ap => { if (Array.isArray(ap)) { todas.push(ap) } })
        })

        console.log(todas)

        todas.forEach(apuesta => {
            if (apuesta[3] === 'mitad' && Number.isInteger(+apuesta[6])) { codes_mitad.push(apuesta[6]) }
            if (apuesta[3] === 'ambos' && Number.isInteger(+apuesta[6])) { codes_ambos.push(apuesta[6]) }
            if (apuesta[3] === 'over' && Number.isInteger(+apuesta[6])) { codes_over.push(apuesta[6]) }
            if (apuesta[3] === 'local' && Number.isInteger(+apuesta[6])) { codes_local.push(apuesta[6]) }
            if (apuesta[3] === 'visitante' && Number.isInteger(+apuesta[6])) { codes_visitante.push(apuesta[6]) }
        })

        codes_mitad = [...new Set(codes_mitad)]
        codes_ambos = [...new Set(codes_ambos)]
        codes_over = [...new Set(codes_over)]
        codes_local = [...new Set(codes_local)]
        codes_visitante = [...new Set(codes_visitante)]

        console.log({
            codes_mitad,
            codes_ambos,
            codes_over,
            codes_local,
            codes_visitante,
        })

        const CONTAINER_APUESTAS_AGRUPADAS = document.querySelector('.container-apuestas-agrupadas')



        function pedazos(array, cantidad = 5) {
            var resultado = [];
            for (var i = 0; i < array.length; i += cantidad) {
                resultado.push(array.slice(i, i + cantidad));
            }
            return resultado;
        }

        let codes_mitad_de_cinco = pedazos(codes_mitad)
        let codes_ambos_de_cinco = pedazos(codes_ambos)
        let codes_over_de_cinco = pedazos(codes_over)
        let codes_local_de_cinco = pedazos(codes_local)
        let codes_visitante_de_cinco = pedazos(codes_visitante)

        function generarLinks(array, tipo) {
            return array.map(codes => `https://local.wplay.co/es/type-coupon?coupon_group_by=TIME&mkt_sort=${ tipo }&sb_type_ids=${codes.join('-')}`)
        }

        let links_mitad_de_cinco = generarLinks(codes_mitad_de_cinco, 'OUH1')
        let links_ambos_de_cinco = generarLinks(codes_ambos_de_cinco, 'BTSC')
        let links_over_de_cinco = generarLinks(codes_over_de_cinco, 'HCTG')
        let links_local_de_cinco = generarLinks(codes_local_de_cinco, 'OU1H')
        let links_visitante_de_cinco = generarLinks(codes_visitante_de_cinco, 'OU1A')

        console.log({
            links_mitad_de_cinco,
            links_ambos_de_cinco,
            links_over_de_cinco,
            links_local_de_cinco,
            links_visitante_de_cinco,
            codes_mitad_de_cinco,
            codes_ambos_de_cinco,
            codes_over_de_cinco,
            codes_local_de_cinco,
            codes_visitante_de_cinco,
        })

        let html_agrupados = ''

        if (codes_mitad_de_cinco.length > 0 && codes_mitad_de_cinco[0].length > 0) links_mitad_de_cinco.forEach(link => html_agrupados += `<a href="${link}" target="_blank" rel="noopener noreferrer">mitad</a> - `)
        if (codes_ambos_de_cinco.length > 0 && codes_ambos_de_cinco[0].length > 0) links_ambos_de_cinco.forEach(link => html_agrupados += `<a href="${link}" target="_blank" rel="noopener noreferrer">ambos</a> - `)
        if (codes_over_de_cinco.length > 0 && codes_over_de_cinco[0].length > 0) links_over_de_cinco.forEach(link => html_agrupados += `<a href="${link}" target="_blank" rel="noopener noreferrer">over</a> - `)
        if (codes_local_de_cinco.length > 0 && codes_local_de_cinco[0].length > 0) links_local_de_cinco.forEach(link => html_agrupados += `<a href="${link}" target="_blank" rel="noopener noreferrer">local</a> - `)
        if (codes_visitante_de_cinco.length > 0 && codes_visitante_de_cinco[0].length > 0) links_visitante_de_cinco.forEach(link => html_agrupados += `<a href="${link}" target="_blank" rel="noopener noreferrer">visitante</a> - `)

        CONTAINER_APUESTAS_AGRUPADAS.innerHTML = html_agrupados

    </script>
</body>

</html>